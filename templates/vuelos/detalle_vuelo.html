{% extends 'base.html' %}

{% block title %}{{ vuelo.origen }} → {{ vuelo.destino }} - Detalle del Vuelo{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <!-- Información del vuelo -->
        <div class="card shadow-sm mb-4">
            <div class="card-header card-header-primary">
                <h4 class="mb-0">
                    <i class="fas fa-plane-departure"></i> 
                    Vuelo de {{ vuelo.origen }} a {{ vuelo.destino }}
                </h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-1"><strong><i class="far fa-calendar-alt"></i> Fecha de Salida:</strong> {{ vuelo.fecha_salida|date:"d/m/Y H:i" }}</p>
                        <p class="mb-1"><strong><i class="far fa-clock"></i> Fecha de Llegada:</strong> {{ vuelo.fecha_llegada|date:"d/m/Y H:i" }}</p>
                        <p class="mb-1"><strong><i class="fas fa-hourglass-half"></i> Duración:</strong> {{ vuelo.duracion }}</p>
                    </div>
                    <div class="col-md-6">
                        <p class="mb-1"><strong><i class="fas fa-plane"></i> Avión:</strong> {{ vuelo.avion.modelo }}</p>
                        <p class="mb-1"><strong><i class="fas fa-dollar-sign"></i> Precio Base:</strong> ${{ vuelo.precio_base }}</p>
                        <p class="mb-1"><strong><i class="fas fa-chair"></i> Asientos Disponibles:</strong> {{ vuelo.asientos_disponibles_count }}</p>
                    </div>
                </div>
                <div class="mt-3">
                    <span class="badge bg-{% if vuelo.estado == 'programado' %}success{% elif vuelo.estado == 'en_curso' %}primary{% elif vuelo.estado == 'aterrizado' %}secondary{% elif vuelo.estado == 'cancelado' %}danger{% else %}warning{% endif %}">
                        Estado: {{ vuelo.get_estado_display }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Mapa de asientos -->
        <div class="card shadow-sm">
            <div class="card-header card-header-info">
                <h5 class="mb-0"><i class="fas fa-th"></i> Seleccionar Asiento</h5>
            </div>
            <div class="card-body text-center">
                <!-- Leyenda -->
                <div class="mb-4 p-3 bg-light rounded border">
                    <span class="seat disponible me-2"></span> Disponible
                    <span class="seat ocupado me-2 ms-3"></span> Ocupado
                    <span class="seat primera me-2 ms-3"></span> Primera Clase
                    <span class="seat ejecutivo me-2 ms-3"></span> Clase Ejecutiva
                    <span class="seat economico me-2 ms-3"></span> Clase Económica
                </div>
                
                <!-- Mapa de asientos -->
                <div class="seat-map-container p-4 border rounded bg-light">
                    <div class="text-center mb-3">
                        <h6 class="text-muted">Mapa de Asientos</h6>
                        <small class="text-muted">Frente del Avión ✈️</small>
                    </div>
                    
                    {% for fila, asientos in asientos_por_fila.items %}
                    <div class="seat-row mb-2 d-flex justify-content-center align-items-center">
                        <span class="row-number me-3 fw-bold text-muted" style="width: 30px;">{{ fila }}</span>
                        
                        <div class="seats-container d-flex gap-1">
                            {% for item in asientos %}
                                {% if forloop.counter == 3 %}
                                    <div class="aisle mx-2"></div> <!-- Pasillo entre asientos -->
                                {% endif %}
                                
                                {% if item.estado_vuelo == 'disponible' %}
                                    <a href="{% url 'crear_reserva' vuelo.id item.asiento.id %}" 
                                       class="seat disponible {{ item.asiento.tipo }}" 
                                       title="Asiento {{ item.asiento.numero }} - {{ item.asiento.get_tipo_display }} (Disponible)">
                                        {{ item.asiento.columna }}
                                    </a>
                                {% else %}
                                    <span class="seat ocupado {{ item.asiento.tipo }}" 
                                          title="Asiento {{ item.asiento.numero }} - {{ item.asiento.get_tipo_display }} (Ocupado por {{ item.pasajero.nombre }} {{ item.pasajero.apellido }})">
                                        {{ item.asiento.columna }}
                                    </span>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                    
                    <div class="text-center mt-3">
                        <small class="text-muted">Cola del Avión</small>
                    </div>
                </div>
                <p class="text-muted small mt-3">Haz clic en un asiento disponible para reservarlo.</p>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Información adicional del avión -->
        <div class="card shadow-sm mb-4">
            <div class="card-header card-header-secondary">
                <h5 class="mb-0"><i class="fas fa-info-circle"></i> Detalles del Avión</h5>
            </div>
            <div class="card-body">
                <p class="mb-1"><strong>Modelo:</strong> {{ vuelo.avion.modelo }}</p>
                <p class="mb-1"><strong>Capacidad Total:</strong> {{ vuelo.avion.capacidad }} asientos</p>
                <p class="mb-1"><strong>Configuración:</strong> {{ vuelo.avion.filas }} filas × {{ vuelo.avion.columnas }} columnas</p>
            </div>
        </div>

        <!-- Acciones -->
        <div class="card shadow-sm">
            <div class="card-header card-header-primary">
                <h5 class="mb-0"><i class="fas fa-cogs"></i> Acciones del Vuelo</h5>
            </div>
            <div class="card-body d-grid gap-2">
                <a href="{% url 'reporte_pasajeros_vuelo' vuelo.id %}" class="btn btn-info">
                    <i class="fas fa-file-alt"></i> Ver Reporte de Pasajeros
                </a>
                <a href="{% url 'lista_vuelos' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Volver a Vuelos
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
